# 5월 30일

## K-Means 알고리즘 실습
### 학습시키기
- 5월 26일 데이터 분석 연결
- KMeans를 사용해서 학습시키기
```
        from sklearn.cluster import KMeans

        kmeans = KMeans(n_clusters= 3 , random_state = 2)  
        # n_clusters : 클러스터 개수 임의로 집어넣어보기
        # random_state 값이 같으면 결과가 같게 나옴.

        # 학습만 하지 말고 바로 예측해봐라
        # X가 아니고 아까 스케일링 한 데이터 가져오기
        y_pred = kmeans.fit_predict(X_scaled)
        # 값은 넘파이로 나옴

        # 원래 df 데이터에 클러스터링한 그룹 정보를 컬럼으로 넣어주기
        df['Group'] = y_pred

```
- wcss 값 구하기
    - 그룹의 특징을 나누어보려했을때 특징이 잘 안보인다 -->> 그룹핑이 잘 되지 않았다
    - 그룹의 개수를 바꾸어 보자
    - 1 ~ 10 까지 바꿔가면서 wcss값을 구해본다
    - 1 ~ 10 중 어떤 수를 택할지는 컴퓨터의 도움을 받아보자 : wcss값을 차트로 그려보면 됨.

- 차트를 그려서 확인해보기 (Elbow Method)

- 팔이 굽는 모양이 나온다. 여기서 팔이 확 접히는 부분을 임의로 선택하여 그룹 수를 잡으면 된다.
- wcss 값으로 그룹의 수를 정하고, 그 그룹의 데이터 가져와 특징 확인하기

## K-Means 앱 대시보드 만들기
1. csv 파일을 업로드 할 수 있다.
2. 업로드한 csv파일을 데이터프레임으로 읽고
3. KMeans 클러스터링을 하기 위해 X로 사용할 컬럼을 설정 할 수 있다
4. WCSS를 확인하기 위한 그룹의 갯수를 정할 수 있다 : 1~10개
5. 엘보우 메소드 차트 화면에 표시
6. 그룹핑 하고싶은 개수를 입력한다
7. 위에서 입력한 그룹의 개수로 클러스터링하여 결과를 부여주기 라는 내용으로 앱 대시보드를 만들기
   
### 데이터분석한 코드를 이용하여 앱 대시보드를 만들기
#### 입력한 데이터로 분석결과 보여주기
1. k 개수 선택 옵션 넣기

   - 유저에게 csv 파일을 입력받는데,
   - 데이터의 개수는 10개 이상일 수도
   - 10개 이하일 수도 있으므로 
   - 입력받은 csv파일의 데이터 수 만큼 k값을 조절해주어야 한다.
     - 참고) 데이터의 수 : 데이터의 행의 수 -->> 쉐입을 보면 됨.


2. 이제 wcss를 차트로 그려보기
3. k 개수 선택 옵션 넣기
4. 그룹을 선택해서 볼 수 있도록 만들기



## 내 아마존 인스턴스에 여러 대시보드를 돌려보자
### 실행 과정
- 푸티 사용해서 ec2 접속
- ec2 유저 로그인 $ec2-user
- 아나콘다 환경 들어가기 # conda activate app_dash
- 파일 확인하고 $ ll
- 깃허브 폴더 안으로 들어가서 cd Github
- 깃허브 클론하기 : 깃허브에서 리포지토리 주소 복사해오기
- 깃허브 아이디 입력
- 깃허브 토큰 입력

- 실행시키기 위해서는 해당 폴더로 이동
- 파일 뭐있는가 확인 ($ ll)
- streamlit run app.py 입력

- 주소 복사해서 웹에서 확인해보면 안돌아감

- 방화벽확인
- 아마존 콘솔 홈 로그인
- ec2 메뉴로 들어가서
- 인스턴스 (실행중) 글자 클릭
- 인스턴스이름 클릭 - 보안탭 - 인바운드 규칙 8502 규칙을 또 만들어줘야함
- 규칙추가 - 사용자지정 TCP - 포트 8502 - 애니웨어 IPv4 - 저장
  
### 스트림릿을 24시간 돌아가도록 만들기
#### 터미널 접속을 끊어도 24시간 백그라운드에서 돌아가도록 만들기
- 명령어
```
$ nohup streamlit run app.py &
```
- 백그라운드에서 어떤 프로그램이 돌아가고있는지 확인하기
```
$ top : 전부나옴
$ 컨트롤 + C : 누르면 꺼짐
$ ps : 내 터미널에서 돌아가고있는것만 나옴
$ ps - ef : 돌아가고있는 항목들 나옴.
$ ps -ef | grep streamlit  : 스트림릿 이라는 이름으로 돌아가는거 찾아줘라
```
- 포트 지정해서 백그라운드에서 돌아가게 하기
```
$ nohup streamlit run app.py --server.port 8601 &
```
- 기존에 백그라운드에서 돌아가던 프로그램 멈추기
```
$ kill 283592 (프로세스 아이디)

# 프로세스 아이디는 ps -ef | grep streamlit 명령어를 치면 나오는 내용에서 ec2-user 옆에 있는 숫자 6자리를 보면 됨.
# 6자리 숫자가 두개 있을경우 왼쪽꺼(앞에꺼) 확인하기
```
- 이런식으로 앱 대시보드를 만들때마다 포트를 지정해서 돌릴 수 있음.
  
# 오늘의 유의할 점
- 스펠링 틀리지 않았는지 확인
- 괄호 개수 확인하기


